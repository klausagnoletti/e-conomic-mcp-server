#!/usr/bin/env bash
set -euo pipefail

branch="$(git rev-parse --abbrev-ref HEAD)"

if [[ "$branch" == "main" ]]; then
  if [[ "${ALLOW_MAIN_COMMIT:-}" == "1" ]]; then
    exit 0
  fi

  echo "âœ– Direct commits to main are blocked." >&2
  echo "  Use the testing branch, then merge into main." >&2
  echo "  To override: ALLOW_MAIN_COMMIT=1 git commit ..." >&2
  exit 1
fi
